<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 20 ğŸ’» K-Means Clustering | Statistics &amp; Big Data 24-25 Labs</title>
<meta name="author" content="Dr.Â NiccolÃ² Salvini">
<meta name="description" content="K-means clustering is an unsupervised machine learning algorithm used to group data points into clusters. It is one of the most popular clustering algorithms and is used in a variety of...">
<meta name="generator" content="bookdown 0.29 with bs4_book()">
<meta property="og:title" content="Chapter 20 ğŸ’» K-Means Clustering | Statistics &amp; Big Data 24-25 Labs">
<meta property="og:type" content="book">
<meta property="og:description" content="K-means clustering is an unsupervised machine learning algorithm used to group data points into clusters. It is one of the most popular clustering algorithms and is used in a variety of...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 20 ğŸ’» K-Means Clustering | Statistics &amp; Big Data 24-25 Labs">
<meta name="twitter:description" content="K-means clustering is an unsupervised machine learning algorithm used to group data points into clusters. It is one of the most popular clustering algorithms and is used in a variety of...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.5.1/transition.js"></script><script src="libs/bs3compat-0.5.1/tabs.js"></script><script src="libs/bs3compat-0.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link rel="shortcut icon" href="images/cattolica-logo-favicon.png">
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Statistics &amp; Big Data 24-25 Labs</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> ğŸ«¶ About</a></li>
<li class="book-part">Get Started</li>
<li><a class="" href="prereq.html"><span class="header-section-number">2</span> âœ¨Prerequisites</a></li>
<li><a class="" href="r-packages.html"><span class="header-section-number">3</span> ğŸ“¦ R Packages</a></li>
<li><a class="" href="nice-warm-up.html"><span class="header-section-number">4</span> ğŸ”¥ Nice warm-up</a></li>
<li><a class="" href="syllabus.html"><span class="header-section-number">5</span> ğŸ—’ï¸ Syllabus</a></li>
<li><a class="" href="hypothesis-testing.html"><span class="header-section-number">6</span> ğŸ’» Hypothesis Testing</a></li>
<li><a class="" href="essentials-of-data-wrangling-and-basic-statistics.html"><span class="header-section-number">7</span> ğŸ’» Essentials of Data Wrangling and Basic Statistics</a></li>
<li><a class="" href="lin-reg.html"><span class="header-section-number">8</span> Linear Regression</a></li>
<li><a class="" href="lin-reg-class.html"><span class="header-section-number">9</span> ğŸ’» Linear Regression in class</a></li>
<li><a class="" href="int-samp-q-second.html"><span class="header-section-number">10</span> ğŸ’» Second Intermediate Sample Questions</a></li>
<li><a class="" href="int-samp-q.html"><span class="header-section-number">11</span> ğŸ’» Intermediate Sample Questions</a></li>
<li><a class="" href="anova.html"><span class="header-section-number">12</span> ğŸ’» ANOVA</a></li>
<li><a class="" href="dummy-vars.html"><span class="header-section-number">13</span> ğŸ’» Dummy Variables</a></li>
<li><a class="" href="int-prep.html"><span class="header-section-number">14</span> ğŸ’» Intermediate preparation</a></li>
<li><a class="" href="log-reg.html"><span class="header-section-number">15</span> ğŸ’» Binary Logistic Regression</a></li>
<li><a class="" href="log-reg-ex.html"><span class="header-section-number">16</span> ğŸ’» Binary LogReg exer</a></li>
<li><a class="" href="pca.html"><span class="header-section-number">17</span> ğŸ’» PCA</a></li>
<li><a class="" href="poi-reg-ex.html"><span class="header-section-number">18</span> ğŸ’» Poisson regr exer</a></li>
<li><a class="" href="hier-clust-ex.html"><span class="header-section-number">19</span> ğŸ’» Hierarchical Clustering</a></li>
<li><a class="active" href="k-mean-ex.html"><span class="header-section-number">20</span> ğŸ’» K-Means Clustering</a></li>
<li><a class="" href="reg-tree-ex.html"><span class="header-section-number">21</span> ğŸ’» Regression Trees</a></li>
<li><a class="" href="course-performance.html"><span class="header-section-number">22</span> âš¡ course performance</a></li>
<li><a class="" href="how-to-ask-for-help.html"><span class="header-section-number">23</span> âœ‹ How to ask for help!</a></li>
<li><a class="" href="frequently-asked-questions.html"><span class="header-section-number">24</span> â“ Frequently Asked Questions</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="StatisticsAndParameters.html"><span class="header-section-number">25</span> Symbols, formulas, statistics and parameters</a></li>
<li><a class="" href="appendixdatasets.html"><span class="header-section-number">26</span> Datasets</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://sbd-labs-22-23.netlify.app">View book source <i class="fab fa-gitlab"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="k-mean-ex" class="section level1" number="20">
<h1>
<span class="header-section-number">20</span> ğŸ’» K-Means Clustering<a class="anchor" aria-label="anchor" href="#k-mean-ex"><i class="fas fa-link"></i></a>
</h1>
<p>K-means clustering is an unsupervised machine learning algorithm used to group data points into clusters. It is one of the most popular clustering algorithms and is used in a variety of applications, such as image segmentation, data compression, and market segmentation. The algorithm works by assigning each data point to the closest cluster center, and then iteratively updating the cluster centers to minimize the distance between them and the data points.</p>
<p>If you are stuck either <a href="mailto:niccolo.salvini27@gmail.com">ask to the TA</a> or team work! Collaboration is always key ğŸ‘¯â€â™‚ï¸! As you may notice the functioning is pretty similar to hierarchical clsutering, so we will not spend too much time on that!</p>
<p>Remember also that if you want to visualize clusters you may think to use <code><a href="https://rdrr.io/pkg/factoextra/man/fviz_cluster.html">fviz_cluster()</a></code> from lib <code>factoextra</code>. You can also use the <code>ggplot2</code> package calling the <code>autoplot</code> function on the kmean regression. We are going tp use the same dataset <code>USArrests</code>. We are scaling data beacause we donâ€™t want the clustering algorithm to depend to an arbitrary variable unit, we start by scaling/standardizing the data using the R function. This could/should be done also for hierarchical cluster. Please note also that if you want to consistently reproduce results across you need to set the seed to a specific number with <code>set.seed(28)</code></p>
<div class="sourceCode" id="cb343"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.sthda.com/english/rpkgs/factoextra">factoextra</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: ggplot2</span></span>
<span><span class="co">#&gt; Welcome! Want to learn more? See two factoextra-related books at https://goo.gl/ve3WBa</span></span>
<span><span class="va">scale_USArrests</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">USArrests</span><span class="op">)</span></span>
<span><span class="va">k2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html">kmeans</a></span><span class="op">(</span><span class="va">scale_USArrests</span>, centers <span class="op">=</span> <span class="fl">2</span>, nstart <span class="op">=</span> <span class="fl">25</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_cluster.html">fviz_cluster</a></span><span class="op">(</span><span class="va">k2</span>, data <span class="op">=</span> <span class="va">scale_USArrests</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="09-lab-kmeansclust_files/figure-html/unnamed-chunk-1-1.png" width="100%"></div>
<p>Lets also see how clusters change wrt the number of <span class="math inline">\(k\)</span>s</p>
<div class="sourceCode" id="cb344"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">28</span><span class="op">)</span></span>
<span><span class="va">k3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html">kmeans</a></span><span class="op">(</span><span class="va">scale_USArrests</span>, centers <span class="op">=</span> <span class="fl">3</span>, nstart <span class="op">=</span> <span class="fl">25</span><span class="op">)</span></span>
<span><span class="va">k4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html">kmeans</a></span><span class="op">(</span><span class="va">scale_USArrests</span>, centers <span class="op">=</span> <span class="fl">4</span>, nstart <span class="op">=</span> <span class="fl">25</span><span class="op">)</span></span>
<span><span class="va">k5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html">kmeans</a></span><span class="op">(</span><span class="va">scale_USArrests</span>, centers <span class="op">=</span> <span class="fl">5</span>, nstart <span class="op">=</span> <span class="fl">25</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plots to compare</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_cluster.html">fviz_cluster</a></span><span class="op">(</span><span class="va">k2</span>, geom <span class="op">=</span> <span class="st">"point"</span>, data <span class="op">=</span> <span class="va">scale_USArrests</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"k = 2"</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_cluster.html">fviz_cluster</a></span><span class="op">(</span><span class="va">k3</span>, geom <span class="op">=</span> <span class="st">"point"</span>,  data <span class="op">=</span> <span class="va">scale_USArrests</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"k = 3"</span><span class="op">)</span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_cluster.html">fviz_cluster</a></span><span class="op">(</span><span class="va">k4</span>, geom <span class="op">=</span> <span class="st">"point"</span>,  data <span class="op">=</span> <span class="va">scale_USArrests</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"k = 4"</span><span class="op">)</span></span>
<span><span class="va">p4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_cluster.html">fviz_cluster</a></span><span class="op">(</span><span class="va">k5</span>, geom <span class="op">=</span> <span class="st">"point"</span>,  data <span class="op">=</span> <span class="va">scale_USArrests</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"k = 5"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'gridExtra'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:dplyr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     combine</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, <span class="va">p3</span>, <span class="va">p4</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="09-lab-kmeansclust_files/figure-html/unnamed-chunk-2-1.png" width="100%"></div>
<div id="exercises-5" class="section level2" number="20.1">
<h2>
<span class="header-section-number">20.1</span> Exercises ğŸ‘¨â€ğŸ’»<a class="anchor" aria-label="anchor" href="#exercises-5"><i class="fas fa-link"></i></a>
</h2>
<div class="exercise">
<p><span id="exr:kmeans" class="exercise"><strong>Exercise 20.1  </strong></span>Letâ€™s have a look at an example in R using the <strong>Chatterjee-Price Attitude</strong> Data from the <code><a href="https://rdrr.io/r/base/library.html">library(datasets)</a></code> package. The dataset is a survey of clerical employees of a large financial organization. The data are aggregated from questionnaires of approximately 35 employees for each of 30 (randomly selected) departments. The numbers give the percent proportion of favourable responses to seven questions in each department. For more details, see <code><a href="https://rdrr.io/r/datasets/attitude.html">?attitude</a></code>. We take a subset of the attitude dataset and consider only two variables in our K-Means clustering exercise i.e.Â <code>privileges</code> <code>learning</code>.</p>
<ol style="list-style-type: decimal">
<li>visualize <code>privileges</code> and <code>learning</code> in a scatterplot. Do you see any cluster?</li>
<li>apply algorithm kmeans on data with <span class="math inline">\(k = 2\)</span> and visualize results through the function <code>fviz_cluster</code>
</li>
<li>now letâ€™s try with <span class="math inline">\(k = 3\)</span>, by visual inspection , do you think it is better?</li>
</ol>
</div>
<p>Remember how to use <code>kmeans</code> which is in base::R.</p>
<div class="answer">
<p><strong>Answer to Question</strong> <a href="k-mean-ex.html#exr:kmeans">20.1</a>:</p>
<p>at first select variables from data:</p>
<pre><code><a href="https://dplyr.tidyverse.org">library(dplyr)
selected_data = select(attitude, privileges, learning)
plot(selected_data,  pch =20, cex =2)
  </a></code></pre>
<p>execute k-means algo:</p>
<pre><code>set.seed(28)
km1 = kmeans(selected_data, k = 2, nstart=100)
fviz_cluster(km1, geom = "point", data = selected_data)</code></pre>
<p>letâ€™s try with k = 3</p>
<pre><code>km2 = kmeans(selected_data, k =  3, nstart=100)
fviz_cluster(km2, geom = "point", data = selected_data)</code></pre>
</div>
</div>
<div id="bonus-elbow-method" class="section level2" number="20.2">
<h2>
<span class="header-section-number">20.2</span> bonus: elbow method âœ¨<a class="anchor" aria-label="anchor" href="#bonus-elbow-method"><i class="fas fa-link"></i></a>
</h2>
<p>The main goal of cluster partitioning algorithms, such as k-means clustering, is to minimize the total intra-cluster variation, also known as the total within-cluster variation or total within-cluster sum of square.</p>
<p>$$</p>
<p>minimize(_{k = 1}^{k}W(C_k))
$$
where <span class="math inline">\(C_k\)</span> is the <span class="math inline">\(k^{th}\)</span> cluster and <span class="math inline">\(W(C_k)\)</span> is the within-cluster variation. The total within-cluster sum of square (wss) measures the compactness of the clustering and we want it to be as small as possible. Thus, we can use the following algorithm to define the optimal clusters:</p>
<ol style="list-style-type: decimal">
<li>Compute clustering algorithm (e.g., k-means clustering) for different values of k. For instance, by varying k from 1 to 10 clusters</li>
<li>For each k, calculate the total within-cluster sum of square (wss)</li>
<li>Plot the curve of wss according to the number of clusters k.</li>
<li>The location of a bend (knee) in the plot is generally considered as an indicator of the appropriate number of clusters.</li>
</ol>
<div id="code-implementation" class="section level3" number="20.2.1">
<h3>
<span class="header-section-number">20.2.1</span> code implementation<a class="anchor" aria-label="anchor" href="#code-implementation"><i class="fas fa-link"></i></a>
</h3>
<p>Data is the same as beginning</p>
<div class="sourceCode" id="cb348"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_nbclust.html">fviz_nbclust</a></span><span class="op">(</span><span class="va">scale_USArrests</span>, <span class="va">kmeans</span>, method <span class="op">=</span> <span class="st">"wss"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="09-lab-kmeansclust_files/figure-html/unnamed-chunk-3-1.png" width="100%"></div>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="hier-clust-ex.html"><span class="header-section-number">19</span> ğŸ’» Hierarchical Clustering</a></div>
<div class="next"><a href="reg-tree-ex.html"><span class="header-section-number">21</span> ğŸ’» Regression Trees</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#k-mean-ex"><span class="header-section-number">20</span> ğŸ’» K-Means Clustering</a></li>
<li><a class="nav-link" href="#exercises-5"><span class="header-section-number">20.1</span> Exercises ğŸ‘¨â€ğŸ’»</a></li>
<li>
<a class="nav-link" href="#bonus-elbow-method"><span class="header-section-number">20.2</span> bonus: elbow method âœ¨</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#code-implementation"><span class="header-section-number">20.2.1</span> code implementation</a></li></ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://sbd-labs-22-23.netlify.app/blob/master/09-lab-kmeansclust.Rmd">View source <i class="fab fa-gitlab"></i></a></li>
          <li><a id="book-edit" href="https://sbd-labs-22-23.netlify.app/edit/master/09-lab-kmeansclust.Rmd">Edit this page <i class="fab fa-gitlab"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Statistics &amp; Big Data 24-25 Labs</strong>" was written by Dr.Â NiccolÃ² Salvini. It was last built on 2024-10-26.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
